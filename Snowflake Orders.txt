/*Snowflake database: snowflake_sample_data.tpch_sf100*/
/*Snowflake tables:  orders, SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.LINEITEMSNOWFLAKE_SAMPLE_DATA.TPCH_SF100.ORDERS, nation, customer*/

use schema snowflake_sample_data.tpch_sf100;

/*Find the country and region for each customer*/
With CTE1 AS (
select c.c_custkey, c.c_name, x.r_name, x.n_name
from (
select r_name, r_regionkey,n_name, n_nationkey
from SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.nation n
join SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.region r
on n.n_regionkey = r.r_regionkey
) x
join SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.customer c
on c.c_nationkey = x.n_nationkey
order by r_name, n_name, c_name
)

/*Order Status = 'F' and Year = 1995 by region and country*/
select r_name as region, n_name as country, sum(o_totalprice) as total_sales,
round(avg(o_totalprice),2) as avg_sales,
max(o_totalprice) as max_sales,
min(o_totalprice) as min_sales
from SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.orders o
join CTE1 c
on o.o_custkey = c.c_custkey
where o_orderstatus ='F' and Year(o_orderdate) = 1995
group by r_name, n_name
order by total_sales desc
;

/*Orders Date Range*/
select o_orderdate, o_orderstatus, sum(o_totalprice)
from SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.orders
group by o_orderdate, o_orderstatus
order by o_orderdate desc


select  Year(o_orderdate) as OrderYear, sum(o_totalprice) as totprice
from SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.orders
where o_orderstatus ='F' 
group by OrderYear
order by OrderYear desc


select o_clerk, sum(o_totalprice) 
from SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.orders
where o_orderstatus ='F'and Year(o_orderdate) = 1995
group by o_clerk